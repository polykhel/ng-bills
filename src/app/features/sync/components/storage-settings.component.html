<div class="storage-settings">
  <div class="card">
    <h2>üíæ Storage Settings</h2>
    
    <!-- Current Storage Info -->
    <div class="storage-info">
      <h3>Current Storage</h3>
      <div class="info-row">
        <span class="label">Provider:</span>
        <span class="value">{{ storageStats?.providerName || 'Loading...' }}</span>
      </div>
      <div class="info-row">
        <span class="label">Type:</span>
        <span class="value">{{ storageStats?.type || 'Loading...' }}</span>
      </div>
      @if (storageStats && storageStats.info) {
        <div class="info-row">
          <span class="label">Usage:</span>
          <span class="value">
            {{ formatBytes(storageStats.info.used) }} / 
            {{ formatBytes(storageStats.info.available) }} 
            ({{ storageStats.info.percentage.toFixed(1) }}%)
          </span>
        </div>
        <div class="usage-bar">
          <div class="usage-fill" [style.width.%]="storageStats.info.percentage"></div>
        </div>
      }
    </div>

    <!-- Migration Status -->
    @if (migrationInfo) {
      <div class="migration-status success">
        <h3>‚úÖ Migration Complete</h3>
        <div class="info-row">
          <span class="label">Migrated:</span>
          <span class="value">{{ migrationInfo.migratedAt | date:'medium' }}</span>
        </div>
        <div class="info-row">
          <span class="label">From:</span>
          <span class="value">{{ migrationInfo.fromType }}</span>
        </div>
        <div class="info-row">
          <span class="label">To:</span>
          <span class="value">{{ migrationInfo.toType }}</span>
        </div>
        <details>
          <summary>Records Migrated</summary>
          <ul>
            <li>Profiles: {{ migrationInfo.recordCount.profiles }}</li>
            <li>Cards: {{ migrationInfo.recordCount.cards }}</li>
            <li>Statements: {{ migrationInfo.recordCount.statements }}</li>
            <li>Installments: {{ migrationInfo.recordCount.installments }}</li>
            <li>Cash Installments: {{ migrationInfo.recordCount.cashInstallments }}</li>
            <li>Bank Balances: {{ migrationInfo.recordCount.bankBalances }}</li>
          </ul>
        </details>
      </div>
    }

    <!-- Migration Actions -->
    <div class="actions">
      <h3>Migration Options</h3>
      
      <button 
        class="btn btn-primary"
        (click)="migrateToIndexedDB()"
        [disabled]="migrating || (storageStats?.type === 'indexeddb')">
        @if (migrating) {
          <span class="spinner"></span>
          Migrating...
        } @else {
          Migrate to IndexedDB
        }
      </button>

      @if (migrationInfo) {
        <button 
          class="btn btn-secondary"
          (click)="forceMigration()"
          [disabled]="migrating">
          Re-run Migration
        </button>
      }

      <p class="help-text">
        IndexedDB provides better performance and 50MB+ storage capacity compared to LocalStorage's 5-10MB limit.
        Your LocalStorage data will be preserved as backup.
      </p>
    </div>

    <!-- Data Management -->
    <div class="data-management">
      <h3>Data Management</h3>
      
      <button class="btn btn-success" (click)="exportData()">
        üì• Export Data
      </button>
      
      <button class="btn btn-warning" (click)="importData()">
        üì§ Import Data
      </button>
      
      <input 
        type="file" 
        #fileInput 
        accept=".json" 
        style="display: none" 
        (change)="onFileSelected($event)">

      <p class="help-text">
        Export your data as JSON for backup or transfer to another device.
      </p>
    </div>

    @if (errorMessage) {
      <div class="error-message">
        ‚ö†Ô∏è {{ errorMessage }}
      </div>
    }

    @if (successMessage) {
      <div class="success-message">
        ‚úÖ {{ successMessage }}
      </div>
    }
  </div>
</div>
