<div class="min-h-screen bg-slate-50 p-6">
  <div class="max-w-4xl mx-auto">
    <div class="mb-6">
      <h1 class="text-3xl font-bold text-slate-900">Sync & Backup</h1>
      <p class="text-slate-600 mt-2">Export and import your data securely across devices</p>
    </div>

    <div class="bg-white rounded-lg shadow-sm p-6 mb-6 border border-slate-100">
      <div class="flex items-center gap-2 mb-4">
        <lucide-icon [img]="FileDown" class="w-5 h-5 text-blue-600"></lucide-icon>
        <h2 class="text-xl font-semibold text-slate-900">Manual Sync</h2>
      </div>

      <p class="text-sm text-slate-600 mb-4">
        Export your data as an encrypted file and import it on another device. You can store it in any cloud drive.
      </p>

      <div class="mb-4 flex items-center gap-3">
        <input
          [(ngModel)]="manualEncrypted"
          class="w-4 h-4 text-blue-600 rounded border-slate-300"
          id="manualEncrypted"
          type="checkbox"
        />
        <label class="flex items-center gap-2 text-sm font-medium text-slate-700" for="manualEncrypted">
          <lucide-icon [img]="Lock" class="w-4 h-4"></lucide-icon>
          Encrypt data (recommended)
        </label>
      </div>

      @if (manualEncrypted) {
        <div class="mb-4">
          <label class="block text-sm font-medium text-slate-700 mb-1" for="manualPassword">Password</label>
          <input
            [(ngModel)]="manualPassword"
            class="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            id="manualPassword"
            placeholder="Enter encryption password"
            type="password"
          />
          @if (manualPassword) {
            <div class="mt-2">
              <div class="flex items-center gap-2 text-xs">
                <span class="text-slate-600">Strength:</span>
                <div class="flex-1 h-1.5 bg-slate-200 rounded-full overflow-hidden">
                  <div
                    [class.bg-green-500]="manualPasswordStrength === 'strong'"
                    [class.bg-red-500]="manualPasswordStrength === 'weak'"
                    [class.bg-yellow-500]="manualPasswordStrength === 'medium'"
                    [style.width]="manualStrengthWidth"
                    class="h-full transition-all"
                  ></div>
                </div>
                <span
                  [class.text-green-600]="manualPasswordStrength === 'strong'"
                  [class.text-red-600]="manualPasswordStrength === 'weak'"
                  [class.text-yellow-600]="manualPasswordStrength === 'medium'"
                  class="font-medium"
                >
                      {{ manualPasswordStrength }}
                    </span>
              </div>
            </div>
          }
          <p class="text-xs text-slate-500 mt-1">Remember this password â€” you'll need it to import your data.</p>
        </div>
      }

      <div class="flex flex-wrap gap-3">
        <button
          (click)="handleExport()"
          [disabled]="isProcessing"
          class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-slate-400 disabled:cursor-not-allowed transition-colors"
          type="button"
        >
          @if (isProcessing && !statusMessage.includes('Importing')) {
            <svg class="w-4 h-4 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          } @else {
            <lucide-icon [img]="Download" class="w-4 h-4"></lucide-icon>
          }
          Export Data
        </button>

        <label
          [class.opacity-60]="isProcessing"
          [class.cursor-not-allowed]="isProcessing"
          class="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 cursor-pointer transition-colors">
          @if (isProcessing && statusMessage.includes('Importing')) {
            <svg class="w-4 h-4 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          } @else {
            <lucide-icon [img]="Upload" class="w-4 h-4"></lucide-icon>
          }
          Import Data
          <input (change)="handleImport($event)" [disabled]="isProcessing" accept=".json" class="hidden" type="file"/>
        </label>
      </div>

      @if (statusMessage) {
        <div class="mt-4 p-3 rounded-md text-sm bg-blue-50 text-blue-800 flex items-center gap-2">
          <svg class="w-4 h-4 animate-spin flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          {{ statusMessage }}
        </div>
      }

      @if (message) {
        <div
          [class.bg-green-50]="!isError"
          [class.bg-red-50]="isError"
          [class.text-green-800]="!isError"
          [class.text-red-800]="isError"
          class="mt-4 p-3 rounded-md text-sm border"
          [class.border-green-200]="!isError"
          [class.border-red-200]="isError"
        >
          <div class="flex items-start justify-between gap-3">
            <span>{{ message }}</span>
            @if (showManualReloadButton && !isError) {
              <button
                (click)="reloadPage()"
                class="px-3 py-1 rounded text-xs font-medium bg-green-600 text-white hover:bg-green-700 transition-colors whitespace-nowrap flex-shrink-0"
                type="button">
                Reload
              </button>
            }
          </div>
        </div>
      }
    </div>

    <div class="bg-white rounded-lg shadow-sm p-6 border border-slate-100">
      <div class="flex items-center gap-2 mb-4">
        <lucide-icon [img]="Cloud" class="w-5 h-5 text-blue-600"></lucide-icon>
        <h2 class="text-xl font-semibold text-slate-900">Auto-Sync</h2>
      </div>

      <div class="mb-4 flex items-center gap-3">
        <input
          [(ngModel)]="driveEncrypted"
          class="w-4 h-4 text-blue-600 rounded border-slate-300"
          id="driveEncrypted"
          type="checkbox"
        />
        <label class="flex items-center gap-2 text-sm font-medium text-slate-700" for="driveEncrypted">
          <lucide-icon [img]="Lock" class="w-4 h-4"></lucide-icon>
          Encrypt data (recommended)
        </label>
      </div>

      @if (driveEncrypted) {
        <div class="mb-4">
          <label class="block text-sm font-medium text-slate-700 mb-1" for="drivePassword">Password</label>
          <input
            [(ngModel)]="drivePassword"
            class="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            id="drivePassword"
            placeholder="Enter encryption password"
            type="password"
          />
          @if (drivePassword) {
            <div class="mt-2">
              <div class="flex items-center gap-2 text-xs">
                <span class="text-slate-600">Strength:</span>
                <div class="flex-1 h-1.5 bg-slate-200 rounded-full overflow-hidden">
                  <div
                    [class.bg-green-500]="drivePasswordStrength === 'strong'"
                    [class.bg-red-500]="drivePasswordStrength === 'weak'"
                    [class.bg-yellow-500]="drivePasswordStrength === 'medium'"
                    [style.width]="driveStrengthWidth"
                    class="h-full transition-all"
                  ></div>
                </div>
                <span
                  [class.text-green-600]="drivePasswordStrength === 'strong'"
                  [class.text-red-600]="drivePasswordStrength === 'weak'"
                  [class.text-yellow-600]="drivePasswordStrength === 'medium'"
                  class="font-medium"
                >
                      {{ drivePasswordStrength }}
                    </span>
              </div>
            </div>
          }
          @if (!drivePassword) {
            <p class="text-xs text-red-600 mt-1">Password required to restore encrypted backup</p>
          } @else {
            <p class="text-xs text-slate-500 mt-1">This password is for Auto-Sync only.</p>
          }
        </div>
      }

      <div class="mb-4 flex items-center gap-3">
        <input
          [(ngModel)]="autoSyncEnabled"
          (ngModelChange)="onAutoSyncEnabledChange()"
          class="w-4 h-4 text-blue-600 rounded border-slate-300"
          id="autoSyncEnabled"
          type="checkbox"
        />
        <label class="flex items-center gap-2 text-sm font-medium text-slate-700" for="autoSyncEnabled">
          <lucide-icon [img]="Cloud" class="w-4 h-4"></lucide-icon>
          Enable Auto-Sync
        </label>
      </div>

      @if (autoSyncEnabled) {
        <div class="mb-4">
          <label class="block text-sm font-medium text-slate-700 mb-2" for="autoSyncInterval">Sync every (minutes)</label>
          <div class="flex items-center gap-2">
            <input
              [(ngModel)]="autoSyncInterval"
              (ngModelChange)="onAutoSyncIntervalChange()"
              type="number"
              [min]="MIN_AUTO_SYNC_INTERVAL"
              [max]="MAX_AUTO_SYNC_INTERVAL"
              class="w-20 px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              id="autoSyncInterval"
            />
            <span class="text-sm text-slate-600">{{ MIN_AUTO_SYNC_INTERVAL }} - {{ MAX_AUTO_SYNC_INTERVAL }} min</span>
          </div>
          <p class="text-xs text-slate-500 mt-1">Data will sync automatically at this interval and when you close the app</p>
        </div>
      }
      <p class="text-xs text-slate-500 mb-4">When enabled, backup is stored in a hidden Google Drive folder. When disabled, it's stored in your main Drive.</p>

      <div class="flex flex-wrap items-center gap-3 mb-4 text-sm">
        <span class="px-2 py-1 rounded-full"
              [class.bg-green-100]="driveStatus().isSignedIn"
              [class.text-green-800]="driveStatus().isSignedIn"
              [class.bg-amber-100]="!driveStatus().isSignedIn"
              [class.text-amber-800]="!driveStatus().isSignedIn">
          {{ driveStatus().isSignedIn ? 'Signed in' : 'Not signed in' }}
        </span>
        @if (autoSyncEnabled) {
          <span class="px-2 py-1 rounded-full bg-blue-100 text-blue-800">
            {{ autoSyncStatusText }}
          </span>
          @if (nextAutoSyncTime) {
            <span class="text-slate-500">
              Next sync: {{ nextAutoSyncTime | date:'short' }}
            </span>
          }
        }
        <span class="text-slate-500" *ngIf="driveStatus().lastSyncTime && !autoSyncEnabled">
          Last sync: {{ driveStatus().lastSyncTime | date:'short' }}
        </span>
        <span class="text-red-600" *ngIf="driveStatus().error">{{ driveStatus().error }}</span>
      </div>

      <div class="flex flex-wrap gap-2">
        <button type="button"
          class="flex items-center gap-2 px-4 py-2 rounded-md text-white transition-colors"
          [ngClass]="driveStatus().isSignedIn ? 'bg-slate-400 hover:bg-slate-500' : 'bg-blue-600 hover:bg-blue-700'"
          [disabled]="isDriveProcessing"
                (click)="driveStatus().isSignedIn ? handleDriveSignOut() : handleDriveSignIn()">
          @if (isDriveProcessing && driveStatusMessage.includes('Signing')) {
            <svg class="w-4 h-4 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          } @else {
            <lucide-icon [img]="Cloud" class="w-4 h-4"></lucide-icon>
          }
          {{ driveStatus().isSignedIn ? 'Sign out' : 'Sign in with Google' }}
        </button>

        <button type="button"
                class="flex items-center gap-2 px-4 py-2 rounded-md bg-green-600 text-white hover:bg-green-700 disabled:opacity-50 transition-colors"
                [disabled]="isDriveProcessing || !driveStatus().isSignedIn"
                (click)="handleDriveUpload()">
          @if (isDriveProcessing && driveStatusMessage.includes('Syncing')) {
            <svg class="w-4 h-4 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          } @else {
            <lucide-icon [img]="Upload" class="w-4 h-4"></lucide-icon>
          }
          Sync to Drive
        </button>

        <button type="button"
                class="flex items-center gap-2 px-4 py-2 rounded-md bg-amber-600 text-white hover:bg-amber-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                [disabled]="isDriveProcessing || !driveStatus().isSignedIn || isRestoreDisabled"
                [title]="isRestoreDisabled ? 'Please enter a password to restore encrypted backup' : ''"
                (click)="handleDriveRestore()">
          @if (isDriveProcessing && driveStatusMessage.includes('Restoring')) {
            <svg class="w-4 h-4 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          } @else {
            <lucide-icon [img]="Download" class="w-4 h-4"></lucide-icon>
          }
          Restore from Drive
        </button>
      </div>

      @if (driveStatusMessage) {
        <div class="mt-3 p-3 rounded-md text-sm bg-blue-50 text-blue-800 flex items-center gap-2">
          <svg class="w-4 h-4 animate-spin flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          {{ driveStatusMessage }}
        </div>
      }

      <div *ngIf="driveMessage" class="mt-3 p-3 rounded-md text-sm border"
           [class.bg-green-50]="!driveError"
           [class.bg-red-50]="driveError"
           [class.text-green-800]="!driveError"
           [class.text-red-800]="driveError"
           [class.border-green-200]="!driveError"
           [class.border-red-200]="driveError">
        <div class="flex items-start justify-between gap-3">
          <span>{{ driveMessage }}</span>
          @if (showReloadButton && !driveError) {
            <button
              (click)="reloadPage()"
              class="px-3 py-1 rounded text-xs font-medium bg-green-600 text-white hover:bg-green-700 transition-colors whitespace-nowrap flex-shrink-0"
              type="button">
              Reload
            </button>
          }
        </div>
      </div>
    </div>

    <div class="mt-6 bg-slate-50 rounded-lg p-4 border border-slate-200">
      <div class="flex items-start gap-2">
        <lucide-icon [img]="AlertCircle" class="w-4 h-4 text-slate-600 mt-0.5"></lucide-icon>
        <div class="flex-1">
          <h3 class="font-medium text-slate-900 mb-1">Your Data</h3>
          <p class="text-sm text-slate-600">Current data size: <span class="font-medium">{{ formattedDataSize }}</span>
          </p>
          <p class="text-xs text-slate-500 mt-1">Approximate size of your backup file</p>
        </div>
      </div>
    </div>

    <div class="mt-4 bg-blue-50 rounded-lg p-4 border border-blue-200">
      <h3 class="font-semibold text-blue-900 mb-2">How to sync between devices:</h3>
      <ol class="text-sm text-blue-800 space-y-1 list-decimal list-inside">
        <li>Export your data with a strong password.</li>
        <li>Store the backup file in your cloud storage (Dropbox, iCloud, Google Drive, etc.).</li>
        <li>Download the file on your other device.</li>
        <li>Import the file using the same password.</li>
      </ol>
    </div>
  </div>
</div>
