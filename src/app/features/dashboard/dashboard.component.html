@if (!isLoaded) {
  <div class="p-6 text-slate-500">Loading...</div>
} @else {
  <div class="flex flex-col gap-2 md:gap-3">
    <app-stats-cards
      (bankBalanceChange)="onBankBalanceChange($event)"
      (disableTracking)="disableBankBalanceTracking()"
      [balanceStatus]="balanceStatus"
      [bankBalanceTrackingEnabled]="bankBalanceTrackingEnabled"
      [billTotal]="totals.billTotal"
      [currentBankBalance]="currentBankBalance"
      [installmentTotal]="totals.installmentTotal"
      [multiProfileMode]="multiProfileMode"
      [profilesCount]="profiles.length"
      [unpaidTotal]="totals.unpaidTotal"
    ></app-stats-cards>

    <app-bank-balance-toggle
      (enable)="enableBankBalanceTracking()"
      [enabled]="bankBalanceTrackingEnabled"
    ></app-bank-balance-toggle>

    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
      <app-bills-table-header
        (columnVisibilityChange)="setColumnVisibility($event)"
        (copySelected)="copySelectedCards()"
        (exportCSV)="handleExportMonthCSV()"
        (setBulkSelectMode)="setBulkSelectMode($event)"
        [batchCopied]="batchCopied"
        [bulkSelectMode]="bulkSelectMode"
        [columnVisibility]="columnVisibility"
        [selectedCardsCount]="selectedCards.size"
        [viewDate]="viewDate"
      ></app-bills-table-header>

      <app-bills-table
        (copied)="setCopiedId($event)"
        (sortChange)="handleSort($event)"
        (toggleAllCards)="toggleAllCards()"
        (toggleBilled)="handleToggleBilled($event)"
        (toggleCardSelection)="toggleCardSelection($event)"
        (toggleCashInstallmentPaid)="handleToggleCashInstallmentPaid($event)"
        (toggleOneTimeBillPaid)="handleToggleOneTimeBillPaid($event)"
        (togglePaid)="handleTogglePaid($event)"
        [bulkSelectMode]="bulkSelectMode"
        [columnVisibility]="columnVisibility"
        [dashboardSort]="dashboardSort"
        [onCopyCardInfo]="copyCardInfo"
        [selectedCards]="selectedCards"
        [sortedData]="sortedDashboardData"
      ></app-bills-table>
    </div>
  </div>
}
