<div class="max-w-7xl mx-auto px-4 py-6">
  @if (!activeProfile()) {
    <app-empty-state
      [icon]="Wallet"
      title="No Profile Selected"
      message="Select a profile to view your financial overview"
    />
  } @else {
    <!-- Key Metrics -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
      <app-metric-card
        [icon]="Wallet"
        label="Available Balance"
        [value]="'₱' + metrics().availableBalance.toLocaleString()"
        subtitle="What you can spend now"
        variant="success"
      />

      <app-metric-card
        [icon]="TrendingUp"
        label="Bank Balance"
        [value]="'₱' + metrics().totalBalance.toLocaleString()"
        subtitle="Total in your account"
        variant="default"
      />

      <app-metric-card
        [icon]="TrendingDown"
        label="Committed"
        [value]="'₱' + metrics().committedBalance.toLocaleString()"
        subtitle="Bills due this month"
        variant="warning"
      />
    </div>

    <!-- Cash Flow Summary -->
    <div class="bg-white rounded-lg border border-slate-200 shadow-sm p-6 mb-8">
      <h3 class="text-lg font-semibold text-slate-900 mb-4">Cash Flow This Month</h3>
      <div class="space-y-3">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-2">
            <lucide-angular [img]="TrendingUp" [size]="20" class="text-green-600" />
            <span class="text-slate-700">Income</span>
          </div>
          <span class="text-lg font-semibold text-green-600">
            ₱{{ metrics().monthlyIncome.toLocaleString() }}
          </span>
        </div>

        <div class="flex items-center justify-between">
          <div class="flex items-center gap-2">
            <lucide-angular [img]="TrendingDown" [size]="20" class="text-red-600" />
            <span class="text-slate-700">Expenses</span>
          </div>
          <span class="text-lg font-semibold text-red-600">
            ₱{{ metrics().monthlyExpenses.toLocaleString() }}
          </span>
        </div>

        <div class="pt-3 border-t border-slate-200">
          <div class="flex items-center justify-between">
            <span class="font-medium text-slate-700">Net Cash Flow</span>
            <span
              class="text-lg font-bold"
              [class.text-green-600]="metrics().netCashFlow >= 0"
              [class.text-red-600]="metrics().netCashFlow < 0"
            >
              {{ metrics().netCashFlow >= 0 ? '+' : '' }}₱{{
                Math.abs(metrics().netCashFlow).toLocaleString()
              }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
      <app-quick-action-button
        [icon]="Plus"
        label="Add Transaction"
        variant="primary"
        (clicked)="onAddTransaction()"
      />

      <app-quick-action-button
        [icon]="CreditCard"
        label="Pay Bill"
        variant="secondary"
        (clicked)="onPayBill()"
      />

      <app-quick-action-button
        [icon]="PieChart"
        label="View Budget"
        variant="secondary"
        (clicked)="onViewBudget()"
      />
    </div>

    <!-- Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Upcoming Bills -->
      <div class="bg-white rounded-lg border border-slate-200 shadow-sm p-6">
        <app-section-header
          [icon]="Calendar"
          title="Upcoming Bills"
          [badge]="upcomingBills().length > 0 ? upcomingBills().length.toString() : undefined"
          actionLabel="View All"
        />

        @if (upcomingBills().length === 0) {
          <app-empty-state
            title="No bills due soon"
            message="You're all caught up for the next 7 days"
          />
        } @else {
          <div class="space-y-3">
            @for (bill of upcomingBills(); track bill.cardId) {
              <div
                class="flex items-center justify-between p-3 rounded-lg border border-slate-200 hover:border-blue-300 transition-colors"
              >
                <div>
                  <div class="font-medium text-slate-900">{{ bill.cardName }}</div>
                  <div class="text-sm text-slate-600">
                    Due {{ bill.dueDate | date : 'MMM d' }}
                  </div>
                </div>
                <div class="text-right">
                  <div class="font-semibold text-slate-900">
                    ₱{{ bill.amount.toLocaleString() }}
                  </div>
                </div>
              </div>
            }
          </div>
        }
      </div>

      <!-- Recent Transactions -->
      <div class="bg-white rounded-lg border border-slate-200 shadow-sm p-6">
        <app-section-header
          [icon]="TrendingDown"
          title="Recent Transactions"
          actionLabel="View All"
        />

        @if (recentTransactions().length === 0) {
          <app-empty-state
            title="No transactions yet"
            message="Start tracking your income and expenses"
            actionLabel="Add Transaction"
            (action)="onAddTransaction()"
          />
        } @else {
          <div class="space-y-3">
            @for (transaction of recentTransactions(); track transaction.id) {
              <div
                class="flex items-center justify-between p-3 rounded-lg border border-slate-200 hover:border-blue-300 transition-colors"
              >
                <div class="flex-1">
                  <div class="font-medium text-slate-900">{{ transaction.description }}</div>
                  <div class="text-sm text-slate-600">
                    {{ formatDate(transaction.date) }}
                    @if (transaction.categoryId) {
                      • {{ getCategoryName(transaction.categoryId) }}
                    }
                  </div>
                </div>
                <div class="text-right">
                  <div
                    class="font-semibold"
                    [class.text-green-600]="transaction.type === 'income'"
                    [class.text-red-600]="transaction.type === 'expense'"
                  >
                    {{ transaction.type === 'income' ? '+' : '-' }}₱{{ transaction.amount.toLocaleString() }}
                  </div>
                </div>
              </div>
            }
          </div>
        }
      </div>

      <!-- Savings Goals -->
      <div class="bg-white rounded-lg border border-slate-200 shadow-sm p-6">
        <app-section-header
          [icon]="Target"
          title="Savings Goals"
          actionLabel="View All"
        />

        @if (savingsGoals().length === 0) {
          <app-empty-state
            title="No active goals"
            message="Create savings goals to track your progress"
            actionLabel="Create Goal"
          />
        } @else {
          <div class="space-y-3">
            @for (goal of savingsGoals(); track goal.id) {
              <div class="p-3 rounded-lg border border-slate-200">
                <div class="flex items-center justify-between mb-2">
                  <div class="flex items-center gap-2">
                    <div
                      class="w-8 h-8 rounded-full flex items-center justify-center text-white text-xs"
                      [style.background-color]="goal.color"
                    >
                      <lucide-angular [img]="Target" [size]="16" />
                    </div>
                    <div>
                      <div class="font-medium text-slate-900 text-sm">{{ goal.name }}</div>
                      <div class="text-xs text-slate-600">
                        ₱{{ goal.currentAmount.toLocaleString() }} / ₱{{ goal.targetAmount.toLocaleString() }}
                      </div>
                    </div>
                  </div>
                  <div class="text-xs font-semibold" [style.color]="goal.color">
                    {{ goal.progress.percentage.toFixed(0) }}%
                  </div>
                </div>
                <div class="h-2 bg-slate-200 rounded-full overflow-hidden">
                  <div
                    class="h-full transition-all"
                    [style.width.%]="goal.progress.percentage"
                    [style.background-color]="goal.color"
                  ></div>
                </div>
              </div>
            }
          </div>
        }
      </div>

      <!-- Budget Summary -->
      <div class="bg-white rounded-lg border border-slate-200 shadow-sm p-6">
        <app-section-header [icon]="PieChart" title="Budget Summary" actionLabel="Manage Budget" />

        @if (!budgetSummary()) {
          <app-empty-state
            title="No budget set"
            message="Create a budget to track your spending by category"
            actionLabel="Create Budget"
            (action)="onViewBudget()"
          />
        } @else {
          <div class="space-y-4">
            <!-- Summary Metrics -->
            <div class="grid grid-cols-3 gap-4">
              <div>
                <div class="text-xs text-slate-600 mb-1">Total Budget</div>
                <div class="font-semibold text-slate-900">
                  ₱{{ budgetSummary()!.totalBudget.toLocaleString() }}
                </div>
              </div>
              <div>
                <div class="text-xs text-slate-600 mb-1">Spent</div>
                <div class="font-semibold text-red-600">
                  ₱{{ budgetSummary()!.totalSpent.toLocaleString() }}
                </div>
              </div>
              <div>
                <div class="text-xs text-slate-600 mb-1">Remaining</div>
                <div
                  class="font-semibold"
                  [class.text-green-600]="budgetSummary()!.remaining >= 0"
                  [class.text-red-600]="budgetSummary()!.remaining < 0"
                >
                  ₱{{ budgetSummary()!.remaining.toLocaleString() }}
                </div>
              </div>
            </div>

            <!-- Progress Bar -->
            <div>
              <div class="flex items-center justify-between mb-1">
                <span class="text-xs font-medium text-slate-700">Overall Progress</span>
                <span class="text-xs font-semibold text-slate-900">
                  {{ budgetSummary()!.percentageUsed.toFixed(1) }}%
                </span>
              </div>
              <div class="h-2 bg-slate-200 rounded-full overflow-hidden">
                <div
                  class="h-full transition-all"
                  [style.width.%]="Math.min(budgetSummary()!.percentageUsed, 100)"
                  [class.bg-green-500]="budgetSummary()!.percentageUsed < 60"
                  [class.bg-yellow-500]="budgetSummary()!.percentageUsed >= 60 && budgetSummary()!.percentageUsed < 80"
                  [class.bg-red-500]="budgetSummary()!.percentageUsed >= 80"
                ></div>
              </div>
            </div>

            <!-- Top Categories -->
            @if (budgetSummary()!.topCategories.length > 0) {
              <div class="space-y-2">
                <div class="text-xs font-medium text-slate-700">Top Categories</div>
                @for (category of budgetSummary()!.topCategories; track category.categoryId) {
                  <div class="p-2 rounded border border-slate-200">
                    <div class="flex items-center justify-between mb-1">
                      <div class="flex items-center gap-2">
                        <div
                          class="w-2 h-2 rounded-full"
                          [style.background-color]="category.color"
                        ></div>
                        <span class="text-sm font-medium text-slate-900">{{ category.categoryName }}</span>
                      </div>
                      <span class="text-xs font-semibold text-slate-700">
                        {{ category.percentage.toFixed(0) }}%
                      </span>
                    </div>
                    <div class="h-1.5 bg-slate-200 rounded-full overflow-hidden">
                      <div
                        class="h-full transition-all"
                        [style.width.%]="Math.min(category.percentage, 100)"
                        [style.background-color]="category.color"
                      ></div>
                    </div>
                  </div>
                }
              </div>
            }
          </div>
        }
      </div>
    </div>
  }
</div>
