@if (options.length) {
  <div
    (keydown.escape)="open = false"
    class="relative inline-block text-left"
  >
    <button
      (click)="toggleOpen()"
      [attr.aria-expanded]="open"
      aria-haspopup="menu"
      aria-label="Toggle column visibility menu"
      class="px-3 py-1.5 text-xs font-medium bg-white border border-slate-200 rounded-lg shadow-sm hover:border-slate-300 transition"
      type="button"
    >
      Columns
    </button>

    @if (open) {
      <div
        aria-label="Column visibility options"
        class="absolute right-0 mt-1 w-48 rounded-lg border border-slate-200 bg-white shadow-lg z-20"
        role="menu"
      >
        <div class="max-h-64 overflow-auto p-2 space-y-1 text-sm">
          @for (col of options; track col.key) {
            <label
              [class.opacity-60]="col.canHide === false"
              class="flex items-center gap-2 px-2 py-1 rounded hover:bg-slate-50 cursor-pointer"
            >
              <input
                (change)="onToggle(col, !!$any($event.target).checked)"
                [attr.aria-label]="'Toggle column ' + col.label"
                [checked]="col.visible"
                [disabled]="col.canHide === false"
                class="accent-blue-600"
                type="checkbox"
              />
              <span class="text-slate-700 text-xs truncate">{{ col.label }}</span>
            </label>
          }
        </div>
        <div class="flex items-center justify-between px-2 py-2 border-t border-slate-100">
          <button (click)="reset.emit()" class="text-xs text-blue-600 hover:text-blue-800 font-medium" type="button">
            Reset
          </button>
          <button (click)="open = false" class="text-xs text-slate-500 hover:text-slate-700" type="button">
            Close
          </button>
        </div>
      </div>
    }
  </div>
}
